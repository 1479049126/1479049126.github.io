<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Redis学习笔记 | comet's Blog</title><meta name="description" content="RedisNoSQL:非关系型数据库，作为关系数据库的补充 作用：基于海量用户和海量数据前提下的数据处理 特征：  可扩充，可伸缩 大数据高性能 灵活数据模型 高可用  常见的NoSQL数据库：  Redis memcache HBase MongoDB  RedisC语言开发的开源的高性能键值对数据库 特征：  数据没有必然关系 内部单线程 高性能 多数据支持 String List hash"><meta name="keywords" content="Redis"><meta name="author" content="挥杆的棒球手"><meta name="copyright" content="挥杆的棒球手"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Redis学习笔记"><meta name="twitter:description" content="RedisNoSQL:非关系型数据库，作为关系数据库的补充 作用：基于海量用户和海量数据前提下的数据处理 特征：  可扩充，可伸缩 大数据高性能 灵活数据模型 高可用  常见的NoSQL数据库：  Redis memcache HBase MongoDB  RedisC语言开发的开源的高性能键值对数据库 特征：  数据没有必然关系 内部单线程 高性能 多数据支持 String List hash"><meta name="twitter:image" content="https://1479049126.github.io/img/2.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Redis学习笔记"><meta property="og:url" content="https://1479049126.github.io/posts/67246/"><meta property="og:site_name" content="comet's Blog"><meta property="og:description" content="RedisNoSQL:非关系型数据库，作为关系数据库的补充 作用：基于海量用户和海量数据前提下的数据处理 特征：  可扩充，可伸缩 大数据高性能 灵活数据模型 高可用  常见的NoSQL数据库：  Redis memcache HBase MongoDB  RedisC语言开发的开源的高性能键值对数据库 特征：  数据没有必然关系 内部单线程 高性能 多数据支持 String List hash"><meta property="og:image" content="https://1479049126.github.io/img/2.jpg"><meta property="article:published_time" content="2020-06-30T06:25:00.000Z"><meta property="article:modified_time" content="2020-06-30T06:23:53.673Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://1479049126.github.io/posts/67246/"><link rel="next" title="lay—ui上传图片模板" href="https://1479049126.github.io/posts/8874/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">25</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">13</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">13</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis"><span class="toc-number">1.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NoSQL"><span class="toc-number">1.0.1.</span> <span class="toc-text">NoSQL:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-1"><span class="toc-number">1.1.</span> <span class="toc-text">Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis基本操作"><span class="toc-number">1.2.</span> <span class="toc-text">Redis基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#信息查询"><span class="toc-number">1.2.1.</span> <span class="toc-text">信息查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取帮助"><span class="toc-number">1.2.2.</span> <span class="toc-text">获取帮助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#退出"><span class="toc-number">1.2.3.</span> <span class="toc-text">退出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据类型介绍"><span class="toc-number">1.3.</span> <span class="toc-text">数据类型介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#业务数据的特殊性"><span class="toc-number">1.3.1.</span> <span class="toc-text">业务数据的特殊性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#String"><span class="toc-number">1.3.2.</span> <span class="toc-text">String</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#作为数值进行操作（最大的数值上限java-中long）"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">作为数值进行操作（最大的数值上限java 中long）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置数据的生命周期"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">设置数据的生命周期</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash类型"><span class="toc-number">1.3.3.</span> <span class="toc-text">hash类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本操作"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">基本操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">List</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#命令"><span class="toc-number">1.3.3.2.1.</span> <span class="toc-text">命令</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Set"><span class="toc-number">1.4.</span> <span class="toc-text">Set</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注意事项"><span class="toc-number">1.4.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sorted-set"><span class="toc-number">1.5.</span> <span class="toc-text">sorted_set</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#业务场景"><span class="toc-number">1.5.0.1.</span> <span class="toc-text">业务场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#功能"><span class="toc-number">1.5.0.2.</span> <span class="toc-text">功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例"><span class="toc-number">1.6.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis通用命令"><span class="toc-number">1.7.</span> <span class="toc-text">Redis通用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Key的基本操作"><span class="toc-number">1.7.1.</span> <span class="toc-text">Key的基本操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展操作"><span class="toc-number">1.7.2.</span> <span class="toc-text">扩展操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库通用操作"><span class="toc-number">1.7.3.</span> <span class="toc-text">数据库通用操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis持久化"><span class="toc-number">1.8.</span> <span class="toc-text">Redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB"><span class="toc-number">1.8.1.</span> <span class="toc-text">RDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF（主流）"><span class="toc-number">1.8.2.</span> <span class="toc-text">AOF（主流）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF重写"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">AOF重写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事务"><span class="toc-number">1.8.3.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#锁"><span class="toc-number">1.8.4.</span> <span class="toc-text">锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分布式锁"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">分布式锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除策略"><span class="toc-number">1.8.5.</span> <span class="toc-text">删除策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#过期数据"><span class="toc-number">1.8.5.1.</span> <span class="toc-text">过期数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#删除策略（加粗标题为redis使用）"><span class="toc-number">1.8.5.1.1.</span> <span class="toc-text">删除策略（加粗标题为redis使用）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#逐出算法"><span class="toc-number">1.8.6.</span> <span class="toc-text">逐出算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#检测易失数据"><span class="toc-number">1.8.6.1.</span> <span class="toc-text">检测易失数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#检测全库数据"><span class="toc-number">1.8.6.2.</span> <span class="toc-text">检测全库数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#放弃数据追逐"><span class="toc-number">1.8.6.3.</span> <span class="toc-text">放弃数据追逐</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基本设置"><span class="toc-number">1.8.7.</span> <span class="toc-text">基本设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#服务器配置"><span class="toc-number">1.8.7.1.</span> <span class="toc-text">服务器配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#日志配置"><span class="toc-number">1.8.7.2.</span> <span class="toc-text">日志配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#客户端配置"><span class="toc-number">1.8.7.3.</span> <span class="toc-text">客户端配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多服务器快捷配置"><span class="toc-number">1.8.7.4.</span> <span class="toc-text">多服务器快捷配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高级数据类型"><span class="toc-number">1.9.</span> <span class="toc-text">高级数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bitmaps（统计状态）"><span class="toc-number">1.9.1.</span> <span class="toc-text">Bitmaps（统计状态）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#二进制位存储"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">二进制位存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#业务场景-1"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">业务场景</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#统计周，月，年"><span class="toc-number">1.9.1.2.1.</span> <span class="toc-text">统计周，月，年</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HyperLogLog"><span class="toc-number">1.9.2.</span> <span class="toc-text">HyperLogLog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GEO"><span class="toc-number">1.9.3.</span> <span class="toc-text">GEO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主从复制"><span class="toc-number">1.10.</span> <span class="toc-text">主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#高可用集群"><span class="toc-number">1.10.0.1.</span> <span class="toc-text">高可用集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#主从复制的作用"><span class="toc-number">1.10.0.2.</span> <span class="toc-text">主从复制的作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#过程"><span class="toc-number">1.10.0.3.</span> <span class="toc-text">过程</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/post.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">comet's Blog</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Redis学习笔记</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-06-30 14:25:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-06-30</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-06-30 14:23:53"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-06-30</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Redis/">Redis</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h3 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL:"></a>NoSQL:</h3><p>非关系型数据库，作为关系数据库的补充</p>
<p>作用：基于海量用户和海量数据前提下的数据处理</p>
<p>特征：</p>
<ul>
<li>可扩充，可伸缩</li>
<li>大数据高性能</li>
<li>灵活数据模型</li>
<li>高可用</li>
</ul>
<p>常见的NoSQL数据库：</p>
<ul>
<li>Redis</li>
<li>memcache</li>
<li>HBase</li>
<li>MongoDB</li>
</ul>
<h2 id="Redis-1"><a href="#Redis-1" class="headerlink" title="Redis"></a>Redis</h2><p>C语言开发的开源的高性能键值对数据库</p>
<p>特征：</p>
<ul>
<li>数据没有必然关系</li>
<li>内部单线程</li>
<li>高性能</li>
<li>多数据支持<ul>
<li>String</li>
<li>List</li>
<li>hash</li>
<li>set</li>
<li>sorted_set</li>
</ul>
</li>
<li>持久化</li>
</ul>
<p>应用：</p>
<ul>
<li><p>热点数据加速查询</p>
</li>
<li><p>任务队列，秒杀，抢购</p>
</li>
<li><p>即时信息查询，排行榜</p>
</li>
<li><p>时效性信息控制，验证码</p>
</li>
<li><p>分布式数据共享</p>
</li>
<li><p>消息队列</p>
</li>
<li><p>分布式锁</p>
</li>
</ul>
<h2 id="Redis基本操作"><a href="#Redis基本操作" class="headerlink" title="Redis基本操作"></a>Redis基本操作</h2><h3 id="信息查询"><a href="#信息查询" class="headerlink" title="信息查询"></a>信息查询</h3><p><code>set  key value</code></p>
<p><code>get key</code></p>
<p><code>del key</code></p>
<p>若没有，则为<code>nil</code></p>
<h3 id="获取帮助"><a href="#获取帮助" class="headerlink" title="获取帮助"></a>获取帮助</h3><p><code>help 命令</code></p>
<h3 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h3><p><code>exit</code></p>
<esc>

<p><code>quit</code></p>
<h2 id="数据类型介绍"><a href="#数据类型介绍" class="headerlink" title="数据类型介绍"></a>数据类型介绍</h2><h3 id="业务数据的特殊性"><a href="#业务数据的特殊性" class="headerlink" title="业务数据的特殊性"></a>业务数据的特殊性</h3><p>作为缓存使用</p>
<p>1、原始业务功能设计</p>
<ul>
<li>秒杀</li>
<li>618活动</li>
<li>排队购票</li>
<li>双11活动</li>
</ul>
<p>2、运营平台监控突发高频访问数据</p>
<p>3、高频、复杂的统计数据</p>
<ul>
<li>在线人数</li>
</ul>
<p>附加功能</p>
<p>系统功能优化升级</p>
<p>常用他数据类型</p>
<ul>
<li>Srting  </li>
<li>hash        HashMap</li>
<li>list           LikedList</li>
<li>set           hashSet</li>
<li>sorted_set      TreeSet</li>
</ul>
<p>数据类型永远指的是Value</p>
<p>key部分永远字符串</p>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>添加多个数据</p>
<p><code>mset key value....</code></p>
<p>获得多个数据</p>
<p><code>mget key1 key2....</code></p>
<p>获取数据字符个数（字符串长度）</p>
<p><code>strlen key</code></p>
<p>追加信息到原始信息后部</p>
<p><code>append key value</code></p>
<p>返回追加完后的长度</p>
<h4 id="作为数值进行操作（最大的数值上限java-中long）"><a href="#作为数值进行操作（最大的数值上限java-中long）" class="headerlink" title="作为数值进行操作（最大的数值上限java 中long）"></a>作为数值进行操作（最大的数值上限java 中long）</h4><p>数据的扩展,增加1单位</p>
<p><code>incr key</code></p>
<p>增加指定单位</p>
<p><code>incrby key 单位</code></p>
<p>增加小数</p>
<p><code>incrbyfloat key 单位</code></p>
<p>数据的扩展,减少1单位</p>
<p><code>decr key</code></p>
<p>减少指定单位</p>
<p><code>decrby key 单位</code></p>
<p>减少小数</p>
<p><code>decrby key 单位</code></p>
<h4 id="设置数据的生命周期"><a href="#设置数据的生命周期" class="headerlink" title="设置数据的生命周期"></a>设置数据的生命周期</h4><p><code>setex key seconds value</code></p>
<p><code>psetex</code>为毫秒</p>
<h3 id="hash类型"><a href="#hash类型" class="headerlink" title="hash类型"></a>hash类型</h3><p>对一系列存储数据进行编组，方便管理，应用存储对象信息</p>
<p>一个存储空间存入多个键值对</p>
<p>底层用hash类型实现：文件少时候用类数组，多的时候用HashMap</p>
<h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><p><code>hset key field value</code></p>
<p><code>hget key field</code></p>
<p><code>hgetall key</code></p>
<p><code>hdel key field1</code></p>
<ul>
<li>获取哈希表中所有的字段名称或字段值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hkeys key</span><br><span class="line"></span><br><span class="line">hvals key</span><br></pre></td></tr></table></figure>



<ul>
<li>设置指定字段的数值数据增加</li>
</ul>
<p><code>hsetnx</code></p>
<p>如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作。</p>
<p>如果字段已经存在于哈希表中，操作无效。</p>
<p>如果 key 不存在，一个新哈希表被创建并执行 HSETNX 命令。</p>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>对数据进入存储空间的顺序进行区分</p>
<p>底层：双向链表</p>
<p>好处：可以从两端进行数据的添加删除</p>
<p>保存的数据都是String类型</p>
<p>以队列形式入队</p>
<p>以栈的形式出栈入栈操作</p>
<p>可以对数据进行分页操作，第一页来自List</p>
<h5 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h5><ul>
<li>添加/修改数据</li>
</ul>
<p><code>lpush key value</code>//从左边进</p>
<p><code>rpush key value</code>//从右边进</p>
<ul>
<li>获取数据</li>
</ul>
<p><code>lrange key start stop</code></p>
<p><code>lindex key index</code></p>
<p><code>llen key</code></p>
<ul>
<li>获取并且移除数据</li>
</ul>
<p><code>lpop key</code> 从左出</p>
<p><code>rpop key</code>从右出</p>
<ul>
<li>阻塞等待获取数据并且移除数据</li>
</ul>
<p><code>blpop key timeout</code></p>
<p><code>brpop key timeout</code></p>
<p><img src="http://qafl5j7ot.bkt.clouddn.com/picGO/a.jpg" alt="a"></p>
<p>上面的窗口此时list没有数据，等待下方窗口插入数据后，上方检测到数据，则获取数据</p>
<ul>
<li>移除指定的数据</li>
</ul>
<p><code>lrem key count value</code></p>
<p>count:移除多少个</p>
<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>与hash存储结构完全相同，仅仅存储键，不存储值，并且值不允许重复</p>
<p>应用于随机推荐类信息检索，热点新闻推荐</p>
<p>同类型数据的快速去重</p>
<p>黑白名单设置</p>
<ul>
<li>添加数据</li>
</ul>
<p><code>sadd key member1</code></p>
<ul>
<li>获取全部数据</li>
</ul>
<p><code>smembers key</code></p>
<ul>
<li>删除数据</li>
</ul>
<p><code>rem key member1</code></p>
<ul>
<li>获取集合数据总量</li>
</ul>
<p><code>scard key</code></p>
<ul>
<li>判断集合中是否包含指定数据</li>
</ul>
<p><code>sismember key member</code></p>
<p>有，返回1</p>
<p>没，返回0</p>
<ul>
<li>随机获取数据</li>
</ul>
<p><code>srandmember key count</code></p>
<ul>
<li>随机获得集合huai中的某个数据并将该数据移出集合</li>
</ul>
<p><code>spop key</code></p>
<ul>
<li><p>应用场景：QQ共同好友，微信共同关注公众号</p>
<ul>
<li><p>求两个集合的交、并、差集</p>
<p><code>sinter key1 key2</code></p>
<p><code>sunion key1 key2</code></p>
<p><code>sdiff key1 key2</code></p>
</li>
<li><p>求两个集合的交、并、差并存储到指定集合中</p>
<p><code>sinterstore destion key1 key2</code></p>
<p><code>sunionstore destion key1 key2</code></p>
<p><code>sdiffstore destion key1 key2</code></p>
</li>
<li><p>将指定数据从原始集合中移动到目标集合中</p>
<p><code>smove source destination 目标</code></p>
</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>set不允许重复添加数据，只能添加一份</p>
</li>
</ul>
<h2 id="sorted-set"><a href="#sorted-set" class="headerlink" title="sorted_set"></a>sorted_set</h2><h4 id="业务场景"><a href="#业务场景" class="headerlink" title="业务场景"></a>业务场景</h4><p>  为排行榜进行排序</p>
<p>  会员试用服务</p>
<p>  按权重的消息队列</p>
<p>  数据排序有利于数据的有效性展示，需要提供一种可以根据自身特征进行排序的方式</p>
<p>  可保存可排序的数据</p>
<p>  在set的存储结构上添加可排序字段score（不是数据 ）</p>
<h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><ul>
<li><p>添加数据</p>
<p><code>zadd  key 权重值  value值</code></p>
</li>
<li><p>获取全部数据</p>
<p><code>zrange key start stop [WITHSCORES]//括号里可不写就不展示scores,此处为从小到大排序</code></p>
<p><code>zrevrange key start stop[WITHSCORES]//倒序，从大到小排序</code></p>
</li>
<li><p>删除数据</p>
<p><code>zrem key member</code></p>
</li>
<li><p>按条件获取</p>
<p><code>zrangebysoore key min max [WITHSCORES][LIMIT]</code>//设定最小值和最大值范围内的value</p>
<p><code>zrevrangebysoore key max min [WITHSCORES]</code>//倒叙</p>
<ul>
<li>示例<ul>
<li><code>zrangebyscore h 200 500 limit 0 3 withscores</code> 0-3是索引</li>
</ul>
</li>
</ul>
</li>
<li><p>条件删除数据</p>
<p><code>zremrangebyrank key start stop</code></p>
<p><code>zremrangebysoore key min max</code></p>
</li>
<li><p>获取集合数据总量</p>
<p><code>zcard key</code> //获取数据总条数</p>
<p><code>zcount key min max</code>//在数据范围内的数据有多少个</p>
</li>
<li><p>集合交、并操作</p>
<p><code>zinterstore   放入的表 表的数量 交操作的表的名称</code></p>
<p><code>zunionstore    放入的表 表的数量 并操作的表的名称</code></p>
<p>交操作：获取到两个表中相同的value，并且把score加上</p>
<p>并操作：获取到两个表中所有的value，并且把相同value的score加上</p>
<ul>
<li><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2></li>
</ul>
<p><img src="C:%5CUsers%5C12345%5CDesktop%5C%E7%A4%BA%E4%BE%8B.jpg" alt="示例"></p>
</li>
<li><p>获取数据对应索引（排名）</p>
<p><code>zrank key member</code>注意是从0 开始的</p>
<p><code>zrevrank key member</code></p>
</li>
<li><p>score值的获取和修改</p>
<p><code>zscore key member</code></p>
<p><code>zincrby  key increment member</code></p>
<p>注意：基于set结构的，数据不能重复，如果重复添加相同数据，score值将被反复覆盖，保留最后一次修改的结果</p>
</li>
</ul>
<ul>
<li>数据类型案例：<ul>
<li>按次接算的服务控制<ul>
<li>将初始值设置为最大值-你需要的次数</li>
<li>每次对数值加1</li>
<li>当到达目标次数以后，再加就超过限制，redis就会抛出异常（免去了每次检查是否到目标次数的操作）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Redis通用命令"><a href="#Redis通用命令" class="headerlink" title="Redis通用命令"></a>Redis通用命令</h2><p>key特征：</p>
<ul>
<li>Key是一个字符串，通过key获取保存的数据</li>
</ul>
<h3 id="Key的基本操作"><a href="#Key的基本操作" class="headerlink" title="Key的基本操作"></a>Key的基本操作</h3><ul>
<li><code>del key</code></li>
<li><code>exists key</code></li>
<li><code>type key</code></li>
</ul>
<h3 id="扩展操作"><a href="#扩展操作" class="headerlink" title="扩展操作"></a>扩展操作</h3><ul>
<li><p>sort</p>
</li>
<li></li>
<li><p>为key改名</p>
<ul>
<li><code>rename key newkey</code>若遇到重名的key,直接覆盖</li>
<li><code>renamenx key newkey</code> 若遇到重名的key，更改失败</li>
</ul>
</li>
<li><p>设置有效期</p>
<ul>
<li><code>expire key seconds</code></li>
<li><code>pexpire key millseconds//设置毫秒级数据有效期</code></li>
<li><code>expireat key timestamp//时间戳方式获取</code></li>
<li><code>pexpireat key millisconds-timestamp</code></li>
</ul>
</li>
<li><p>获取key的有效期</p>
<ul>
<li><code>ttl key//返回-2就是已经没了，永久存在返回-1，设置过有效期的返回有效期</code></li>
<li><code>pttl key</code></li>
</ul>
</li>
<li><p>把key从时效性转换为永久性</p>
<ul>
<li><code>persist key</code></li>
</ul>
</li>
<li><p>查找key</p>
<ul>
<li><code>keys pattern</code><ul>
<li>匹配模式<ul>
<li><code>*</code>任意数量的任意字符<ul>
<li><code>keys it*</code>查询所有以it开头的</li>
</ul>
</li>
<li><code>?</code>一个任意符号<ul>
<li><code>keys ??heima</code>查询所有前面两个字符任意，后面以heima结尾</li>
<li><code>keys user:?</code>查询所有以user:开头，最后一个字符任意</li>
</ul>
</li>
<li><code>[]</code>匹配一个指定符号<ul>
<li><code>keys u[st]er:1</code>查询所有以u开头，以er:l结尾，中部包含一个字符 s或t</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="数据库通用操作"><a href="#数据库通用操作" class="headerlink" title="数据库通用操作"></a>数据库通用操作</h3><p>  解决key重复问题</p>
<ul>
<li><p>redis为每个服务提供16个数据库，编号从0-15(默认在0号区工作)</p>
</li>
<li><p>每个数据库之间的数据相互独立</p>
<p>切换数据库</p>
</li>
<li><p><code>select index</code></p>
<p>其他操作</p>
<p><code>quit</code> </p>
<p><code>ping</code>测试服务器是否连通</p>
<p><code>echo</code>给redis输出一个日志</p>
</li>
<li><p>数据移动</p>
<p><code>move key db</code>移动操作必须保证移动去的库没有这个关键词才能移动成功</p>
</li>
<li><p>数据清除</p>
<p><code>dbsize</code>看数据总量</p>
<p><code>flushdb</code>删除某个数据库</p>
<p><code>flushall</code>删除所有数据库数据</p>
</li>
</ul>
<pre><code>## Jedis

JAVA语言连接redis服务

- jedis
- springDta Redis

如何使用jedis

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//连接redis</span></span><br><span class="line">         Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"127.0.0.1"</span>,<span class="number">6379</span>);</span><br><span class="line">       <span class="comment">//操作redis</span></span><br><span class="line">         jedis.set(<span class="string">"name"</span>,<span class="string">"kankan"</span>);<span class="comment">//redis命令</span></span><br><span class="line">       String name = jedis.get(<span class="string">"name"</span>);</span><br><span class="line">         System.out.print(name);</span><br><span class="line">       <span class="comment">//关闭连接</span></span><br><span class="line">         jedis.close();</span><br></pre></td></tr></table></figure>

jedis连接池教程</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">static &#123;</span><br><span class="line">    ResourceBundle rb &#x3D; ResourceBundle.getBundle(&quot;redis&quot;);</span><br><span class="line">    String host &#x3D; rb.getString(&quot;redis.host&quot;);</span><br><span class="line">    int port &#x3D; Integer.parseInt(rb.getString(&quot;redis.port&quot;));</span><br><span class="line">    int maxtotal &#x3D; Integer.parseInt(rb.getString(&quot;redis.maxtotal&quot;));</span><br><span class="line">    int maxIdle &#x3D; Integer.parseInt(rb.getString(&quot;redis.maxIdle&quot;));</span><br><span class="line">    JedisPoolConfig jpc &#x3D; new JedisPoolConfig();</span><br><span class="line">    jpc.setMaxTotal(maxtotal);</span><br><span class="line">    jpc.setMaxIdle(maxIdle);</span><br><span class="line">    jp &#x3D;  new JedisPool(jpc,host,port);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F;对外获取的接口</span><br><span class="line"></span><br><span class="line">   public static Jedis getJedis()&#123;</span><br><span class="line">    return jp.getResource();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  配置文件</p>
<p>  redis.properties</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis.host = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">redis.port = <span class="number">6379</span></span><br><span class="line">redis.maxtotal = <span class="number">30</span></span><br><span class="line">redis.maxIdle = <span class="number">10</span></span><br></pre></td></tr></table></figure>



<h2 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h2><h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><ul>
<li>存储效率高</li>
<li>某时间点数据</li>
<li>恢复数据比AOF快</li>
<li>应用于数据灾难恢复</li>
</ul>
<p>缺点：</p>
<ul>
<li>会丢数据</li>
<li>子进程进行保存，会丢失性能</li>
<li>Redis版本对RDB文件没有统一，无法兼容</li>
</ul>
<p>手动保存</p>
<p><code>save</code></p>
<p>每执行一次会生成一个.rdb的文件来保存信息</p>
<p>save指令时候如果执行时间过长，会阻塞服务器，不推荐在线上服务器上使用</p>
<p><code>save second changes</code>在配置文件中</p>
<p>second-&gt;秒数</p>
<p>changes-&gt;变化的keys的数量</p>
<p>限定时间内key的变化数量达到指定就进行持久化</p>
<p>自动执行</p>
<p><code>bgsave</code></p>
<p>后台保存</p>
<p><img src="https://raw.githubusercontent.com/1479049126/imagerespority/master/img/204375@1592818747@2.png" alt="204375@1592818747@2"></p>
<p>针对save命令做出的优化</p>
<p>启动后台保存操作，不是立即执行</p>
<p>抽空调用fork函数生成子进程-》生成rdb文件</p>
<h3 id="AOF（主流）"><a href="#AOF（主流）" class="headerlink" title="AOF（主流）"></a>AOF（主流）</h3><p>记录操作过程-》降低丢失数据的可能</p>
<p>记录数据产生的过程</p>
<p>解决数据持久化的实时性</p>
<p>原理：</p>
<p>把指令放入刷新缓存区</p>
<p><img src="https://raw.githubusercontent.com/1479049126/imagerespority/master/img/67688@1592820047@2.png" alt="67688@1592820047@2"></p>
<p>写数据的三种策略：</p>
<ul>
<li>always（每次）</li>
</ul>
<p>零误差，性能较低</p>
<ul>
<li><strong>everysec(每秒)</strong></li>
</ul>
<p>数据准确性较高，性能较高</p>
<p>宕机只是丢失一秒的数据</p>
<p>建议使用</p>
<ul>
<li>no(系统控制)</li>
</ul>
<p>操作系统控制每次同步到AOF文件的周期，过程不可控</p>
<p>在配置文件中进行配置</p>
<h4 id="AOF重写"><a href="#AOF重写" class="headerlink" title="AOF重写"></a>AOF重写</h4><p>将数据的若干条指令结果转化成最终结果的数据对应的指令进行记录</p>
<p>作用：</p>
<ul>
<li><p>降低磁盘占用，提高利用率</p>
</li>
<li><p>持久化的效率</p>
</li>
<li><p>降低数据的复用</p>
</li>
</ul>
<p>规则：</p>
<ul>
<li>超时数据不再写</li>
<li>无效指令不用写</li>
<li>多条指令的合并</li>
</ul>
<p>使用<code>bgrewriteaof</code>进行手动重写</p>
<p>也能自动进行重写</p>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>Redis在执行指令时候，多条连续指令被干扰，打断，插队</p>
<p>事务：一个队列，一次性，顺序性，排他性的执行一系列命令</p>
<p><code>multi</code>事务开启的位置，后续所有指令都加入到事务队列中</p>
<p><code>exec</code>事务结束的位置，同时执行队列中事务</p>
<p><code>discard</code>取消事务</p>
<p>若命令中存在语法错误，则事务中的命令都不执行</p>
<p>若存在命令格式正确，却无法正确执行。则正确的命令会执行，错误的命令会报错</p>
<p>已经执行完毕的命令对应的数据不会自动回滚</p>
<h3 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h3><p>对key添加监控锁，在执行exec前如果key发生变化，终止事务执行</p>
<p><code>watch key,....</code></p>
<p><code>unwatch</code>解锁</p>
<h4 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h4><p><code>setnx lock-key 1</code> 设置一个公共锁</p>
<p>类似于淘宝秒杀锁单，锁住一个商品，只能自己用，其他人在你没有操作完成之前是不能使用的</p>
<p>操作结束使用<code>del</code>进行解锁</p>
<p><code>expire lock-key second</code>使用一个过期时间，到点自动解锁</p>
<p><code>pexppire lock-key milliseconds</code></p>
<h3 id="删除策略"><a href="#删除策略" class="headerlink" title="删除策略"></a>删除策略</h3><p><img src="https://raw.githubusercontent.com/1479049126/imagerespority/master/img/120003@1592983500@2.png" alt="120003@1592983500@2"></p>
<p>删除有时效性，并且已经到期的数据</p>
<h4 id="过期数据"><a href="#过期数据" class="headerlink" title="过期数据"></a>过期数据</h4><p>在内存占用与CPU占用之间找一个平衡，CPU空闲维护</p>
<h5 id="删除策略（加粗标题为redis使用）"><a href="#删除策略（加粗标题为redis使用）" class="headerlink" title="删除策略（加粗标题为redis使用）"></a>删除策略（加粗标题为redis使用）</h5><ul>
<li>定时删除（时间换空间）</li>
</ul>
<p>设置一个定时器，当key设置过期时间，且过期时间到达，由定时器任务执行对键的删除操作。</p>
<p>优点：节约内存，到时就删除，快速释放掉不必要内存占用。</p>
<p>缺点：无论CPU负载量多高，都会占用CPU，会影响redis的服务器响应时间和指令吞吐量。</p>
<ul>
<li><strong>惰性删除</strong>（拿空间换时间）</li>
</ul>
<p>数据到达过期时间，不做处理，等下次访问该数据时候：</p>
<p>1、发现过期，删除，返回不存在。</p>
<p>2、发现未过期，返回。</p>
<p>优点：节约CPU性能，发现必须删除时候才进行删除。</p>
<p>缺点：内存压力很大，出现长期占用内存的数据。</p>
<ul>
<li><strong>定期删除</strong></li>
</ul>
<p>每一个库中都有一个expires[*]</p>
<p>redis启动服务初始化时候，会读取配置server.hz的值，默认为10</p>
<p>每秒钟执行server.hz次</p>
<p>serverCron()</p>
<p>-&gt;</p>
<p>databasesCron()          对每个expires[*]逐一的进行检测，每次执行250ms/server.hz,</p>
<p>-&gt;</p>
<p>activeExpireCycle()       W是自己定义的</p>
<p>​                                        ==随机==挑出W个key进行检测</p>
<p>​                                        如果key超时，删除key</p>
<p>​                                        如果一轮删除的key的数量&gt;W*25%（==删除量高==）,继续库中执行</p>
<p>​                                        如果一轮的删除的key的数量&lt;W*25%（==删除量低==),检查下一个expires[],0-15循环</p>
<p>​                                        current_db记录activeExpireCycle()进入哪个expires[*]进行执行，</p>
<p>​                                        这次时间到期，下次从current_db继续向下执行</p>
<p>特点：</p>
<ul>
<li>随机抽查策略，利用过期数据的占比控制删除频率</li>
<li>cpu性能占用设置有峰值，检测频度自定义设置</li>
<li>内存压力不大，没用的数据会被持续清理</li>
</ul>
<p>总结：</p>
<p>​    周期性抽查</p>
<h3 id="逐出算法"><a href="#逐出算法" class="headerlink" title="逐出算法"></a>逐出算法</h3><p>数据都没有过期，长期存在，新数据进入redis时候的检测</p>
<p>在执行每一个命令前，会调用==freeMemoryIfNeeded()==检测内存是否充足，如果内存不满足加入数据的最低存储要求,redis临时删除一些数据为当前指令清理存储空间——数据逐出。</p>
<p>逐出数据不是100%,不成功反复执行，所有数据尝试完毕后，如果不能达到内存清理的要求，出现错误信息。</p>
<p>影响数据逐出的相关配置</p>
<p>在redis.config中</p>
<p><code>maxmemory-policy</code>进行相关配置</p>
<h4 id="检测易失数据"><a href="#检测易失数据" class="headerlink" title="检测易失数据"></a>检测易失数据</h4><p>LRU: 最长时间没有被使用的数据</p>
<p>LFU：在规定时间内使用次数最少的</p>
<ul>
<li>volatile-lru:最近最少使用的数据淘汰</li>
<li>volatile-flu:最近使用次数最少的数据</li>
<li>volatile-ttl:挑选要过期的数据进行淘汰</li>
<li>volatile-random:任意选择进行淘汰</li>
</ul>
<h4 id="检测全库数据"><a href="#检测全库数据" class="headerlink" title="检测全库数据"></a>检测全库数据</h4><ul>
<li>allkeys-lru:挑选最近最少使用的数据淘汰。</li>
<li>allkeys-lfu:挑选最近使用次数最少的数据淘汰。</li>
<li>allkeys-random:任意选择数据淘汰。</li>
</ul>
<h4 id="放弃数据追逐"><a href="#放弃数据追逐" class="headerlink" title="放弃数据追逐"></a>放弃数据追逐</h4><p>no - enviction:禁止驱逐数据（redis4.0中默认策略），会引发内存泄漏</p>
<h3 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a>基本设置</h3><h4 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h4><p><code>bind IP地址</code>绑定主机</p>
<p><code>port 端口号</code> 修改端口号</p>
<p><code>databases 16</code>数据库数量</p>
<h4 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h4><p>设置日志记录级别<code>loglevel debug|verbose|notice|warning</code></p>
<p>开发期设置为verbose</p>
<p>生产环境配置为notice</p>
<p>日志记录文件 <code>logfile 端口号.log</code></p>
<h4 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h4><p>设置同一时间的最大连接数，到达上限，redis会关闭新的连接，默认为无限制</p>
<p><code>maxclients 0</code></p>
<p>客户端闲置等待最大时长，关闭该功能，设置为0</p>
<p><code>timeout 0</code></p>
<h4 id="多服务器快捷配置"><a href="#多服务器快捷配置" class="headerlink" title="多服务器快捷配置"></a>多服务器快捷配置</h4><p>导入并加载指定配置文件，快速创建redis公共配置文件</p>
<p><code>include /path/.conf</code></p>
<h2 id="高级数据类型"><a href="#高级数据类型" class="headerlink" title="高级数据类型"></a>高级数据类型</h2><h3 id="Bitmaps（统计状态）"><a href="#Bitmaps（统计状态）" class="headerlink" title="Bitmaps（统计状态）"></a>Bitmaps（统计状态）</h3><h4 id="二进制位存储"><a href="#二进制位存储" class="headerlink" title="二进制位存储"></a>二进制位存储</h4><p>设置某一位为0或1</p>
<ul>
<li><p><code>setbit key offect value</code>设置位</p>
</li>
<li><p><code>getbit keys offect</code>获得某一个关键词的位</p>
</li>
</ul>
<h4 id="业务场景-1"><a href="#业务场景-1" class="headerlink" title="业务场景"></a>业务场景</h4><p>电影网站</p>
<ul>
<li>统计每天某一部电影是否被点播</li>
<li>每天有多少部电影被点播</li>
<li>每周每月有多少部电影被点播</li>
<li>统计年度哪部电影没有被点播</li>
</ul>
<p>《电影》id:5 offset:4 </p>
<p>0101==0==011    为0代表没有看</p>
<h5 id="统计周，月，年"><a href="#统计周，月，年" class="headerlink" title="统计周，月，年"></a>统计周，月，年</h5><p>每天对电影进行一次统计，</p>
<p>周（7天）对统计的数据进行与操作，结果位为0的代表周从没看过，以此类推</p>
<p><code>bitop op(逻辑操作类型) destKey(结果存入的key)  key1......</code></p>
<ul>
<li>and : 交</li>
<li>or : 并</li>
<li>not: 非</li>
<li>xor: 异或</li>
</ul>
<p>统计key中1的数量</p>
<ul>
<li><code>bitcount key [start end]</code></li>
</ul>
<h3 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h3><p>基数去重</p>
<p>{1，3，5，7，7，5，5}=&gt;去重后=&gt;{1,3,5,7}</p>
<p>只是记录数量，不记录具体数据</p>
<ul>
<li><p>添加数据         <code>pfadd key 数据...</code></p>
</li>
<li><p>统计数据          <code>pfcount key</code></p>
</li>
<li><p>合并数据          <code>pfmerge  destkey(目标) sourcekey(源数据)</code></p>
</li>
</ul>
<p>数据统计，数值存在一定误差</p>
<h3 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h3><p>确定两坐标点的距离</p>
<ul>
<li><p>计算两点的距离</p>
<p><code>geodist key member1</code></p>
</li>
<li><p>获取坐标点</p>
<p><code>geopos key member</code></p>
</li>
<li><p>添加坐标</p>
<p><code>geoadd key longitude(x坐标) latitude(Y坐标) member</code></p>
</li>
<li><p>求范围内的数据</p>
<p><code>georadius key x y radius</code></p>
</li>
</ul>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>主从复制, 把master中的数据，及时，有效的复制到slave中</p>
<p>master职责：</p>
<ul>
<li>写数据</li>
<li>执行写操作，将出现变化的数据自动同步到slave</li>
<li>读数据</li>
</ul>
<p>slave职责：</p>
<ul>
<li>读数据</li>
</ul>
<h4 id="高可用集群"><a href="#高可用集群" class="headerlink" title="高可用集群"></a>高可用集群</h4><p><img src="https://raw.githubusercontent.com/1479049126/imagerespority/master/img/146518@1593332298@2.png" alt="146518@1593332298@2"></p>
<h4 id="主从复制的作用"><a href="#主从复制的作用" class="headerlink" title="主从复制的作用"></a>主从复制的作用</h4><ul>
<li><p>读写分离：master写，slave读，提高服务器的读写负载能力</p>
</li>
<li><p>负载均衡：slave 分担master的负载，根据需求，改变slave的数量，提高redis的服务器并发量和数据吞吐量</p>
</li>
<li><p>故障恢复：当master出现问题时，由slave提供服务，实现快速的故障恢复</p>
</li>
<li><p>数据备份：实现数据热备份</p>
</li>
<li><p>高可用基石：基于主从复制，构建哨兵模式和集群</p>
</li>
</ul>
<h4 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h4><p><img src="https://raw.githubusercontent.com/1479049126/imagerespority/master/img/235335@1593333065@2.png" alt="235335@1593333065@2"></p>
<ul>
<li><p>建立连接阶段</p>
</li>
<li><p>数据同步阶段</p>
</li>
<li><p>命令传播阶段</p>
</li>
</ul>
<p>emmm下面这里因为redisrdb版本不兼容问题，后面的暂时没能做成实验，还没更新</p>
<p>目前正在解决…<br>是使用同一个linux redis进行主从复制实验，但是slave复制master的主文件时出现Redis Can’t handle RDB format version 9，删除虚拟机中所有的rdb也未能解决，如有大佬知道，请带带我！</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">挥杆的棒球手</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://1479049126.github.io/posts/67246/">https://1479049126.github.io/posts/67246/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://1479049126.github.io" target="_blank">comet's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post_share"><div class="social-share" data-image="/img/2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/posts/8874/"><img class="next_cover" src="/img/10.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">lay—ui上传图片模板</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 挥杆的棒球手</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script></body></html>